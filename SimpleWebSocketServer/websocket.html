<!DOCTYPE html>

<head>
<meta charset="utf-8" />

<title>WebSocket Test</title>

<script language="javascript" type="text/javascript">


    function init()
    {
        document.myform.url.value = "ws://localhost:8000/"
        document.myform.inputtext.value = "Hello World!"
        document.myform.disconnectButton.disabled = true;
    }

    function doConnect(cb)
    {
        websocket = new WebSocket(document.myform.url.value);
        websocket.onopen = function(evt) { onOpen(evt, cb) };
        websocket.onclose = function(evt) { onClose(evt) };
        websocket.onmessage = function(evt) { onMessage(evt) };
        websocket.onerror = function(evt) { onError(evt) };
    }

    function onOpen(evt, cb)
    {
        writeToScreen("connected\n");
        document.myform.connectButton.disabled = true;
        document.myform.disconnectButton.disabled = false;
        if (typeof cb !== "undefined") {
            cb.apply(this);
        }
    }

    function onClose(evt)
    {
        writeToScreen("disconnected\n");
        document.myform.connectButton.disabled = false;
        document.myform.disconnectButton.disabled = true;
    }

    function onMessage(evt)
    {
        writeToScreen(evt.data + '\n');
    }

    function onError(evt)
    {
        writeToScreen('error: ' + evt.data + '\n');

        websocket.close();

        document.myform.connectButton.disabled = false;
        document.myform.disconnectButton.disabled = true;

    }

    function doSend(message)
    {
        websocket.send(message);
    }

    function writeToScreen(message)
    {
        document.myform.outputtext.value += message
        document.myform.outputtext.scrollTop = document.myform.outputtext.scrollHeight;

    }

    window.addEventListener("load", init, false);


    function sendText() {
        var snd = function() { doSend( document.myform.inputtext.value ); }
        if (typeof websocket == "undefined" || 1 !== websocket.readyState) {
            doConnect(snd);
        } else {
            snd.apply(this);
        }
    }

    function clearText() {
        document.myform.outputtext.value = "";
    }

    function doDisconnect() {
        websocket.close();
    }


</script>

<style>

    .mainDiv {
        width: 98%;
        height: 100vh;
    }
    textarea {
        width: 100%;
    }
    .outputtext {
        display: block;
        height: 80vh;
        background-color: lightgrey;
    }
</style>
</head>

<div class="mainDiv">

<form name="myform">
<div>
    <textarea name="url" cols="80"></textarea>
    <input type="button" name=disconnectButton value="Disconnect" onClick="doDisconnect();">
    <input type="button" name=connectButton value="Connect" onClick="doConnect();">
</div>
<div>
<textarea readonly class="outputtext" name="outputtext"></textarea>
</div>
<div>
<textarea name="inputtext" cols="80" rows="3"></textarea>
<input type="button" name=sendButton value="Send" onClick="sendText();">
<input type="button" name=clearButton value="Clear" onClick="clearText();">
</div>
<p>

</p>


</form>
</div>
</html>

